<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NodeX // AI Intelligence</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Orbitron:wght@500;700;900&family=Rajdhani:wght@500;700&family=Courier+New&display=swap" rel="stylesheet">
    
    <style>
        /* --- CSS 變數系統 (核心) --- */
        :root {
            /* 預設為 Tech 風格 */
            --nx-bg: #050505;
            --nx-sidebar: #0a0a0a;
            --nx-text: #e0e0e0;
            --nx-text-muted: #888;
            --nx-accent: #00ffcc;
            --nx-border: #333;
            --nx-card-bg: rgba(255,255,255,0.05);
            --nx-input-bg: #141414;
            --nx-radius: 12px;
            --nx-font: 'Inter', sans-serif;
            --nx-glow: 0 0 15px rgba(0, 255, 204, 0.1);
            --nx-hover-bg: rgba(255,255,255,0.1);
            --nx-btn-active-bg: rgba(0, 255, 204, 0.15);
        }

        /* 商務風格 (Business) */
        [data-theme="business"] {
            --nx-bg: #f8f9fa;
            --nx-sidebar: #ffffff;
            --nx-text: #2d3748;
            --nx-text-muted: #718096;
            --nx-accent: #2b6cb0; /* 專業藍 */
            --nx-border: #e2e8f0;
            --nx-card-bg: #ffffff;
            --nx-input-bg: #ffffff;
            --nx-radius: 8px;
            --nx-glow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --nx-font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            --nx-hover-bg: #f7fafc;
            --nx-btn-active-bg: #ebf8ff;
        }

        /* 終端機風格 (Terminal) */
        [data-theme="terminal"] {
            --nx-bg: #000000;
            --nx-sidebar: #000000;
            --nx-text: #33ff00; /* 經典綠 */
            --nx-text-muted: #008800;
            --nx-accent: #33ff00;
            --nx-border: #004400;
            --nx-card-bg: #000000;
            --nx-input-bg: #000000;
            --nx-radius: 0px;
            --nx-font: 'Courier New', monospace;
            --nx-glow: none;
            --nx-hover-bg: #002200;
            --nx-btn-active-bg: #003300;
        }

        /* 基礎重置 */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            background: var(--nx-bg); 
            color: var(--nx-text); 
            font-family: var(--nx-font); 
            height: 100vh; 
            display: flex; 
            overflow: hidden;
            transition: background 0.3s, color 0.3s;
        }

        /* 終端機掃描線特效 */
        [data-theme="terminal"] body::after {
            content: " "; display: block; position: absolute; top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 999; background-size: 100% 2px, 3px 100%; pointer-events: none;
        }

        /* --- 側邊欄 --- */
        .nx-sidebar {
            width: 260px;
            background: var(--nx-sidebar);
            border-right: 1px solid var(--nx-border);
            display: flex;
            flex-direction: column;
            padding: 20px;
            z-index: 10;
            transition: all 0.3s;
        }

        /* Logo (NodeX) */
        .nx-brand {
            display: flex; align-items: center; gap: 10px; margin-bottom: 30px;
            color: var(--nx-text); font-weight: 900; font-size: 1.4rem; letter-spacing: 1px;
            cursor: pointer; font-family: 'Orbitron', sans-serif;
        }
        .nx-logo-svg { width: 36px; height: 36px; fill: none; stroke: var(--nx-accent); stroke-width: 2; }

        /* 新對話按鈕 */
        .nx-btn-new {
            background: var(--nx-card-bg);
            border: 1px solid var(--nx-border);
            color: var(--nx-text);
            padding: 10px;
            border-radius: var(--nx-radius);
            cursor: pointer;
            display: flex; align-items: center; gap: 10px;
            margin-bottom: 20px;
            transition: all 0.2s;
            box-shadow: var(--nx-glow);
            font-weight: 600;
        }
        .nx-btn-new:hover { 
            border-color: var(--nx-accent); 
            color: var(--nx-accent); 
            transform: translateY(-1px);
        }

        /* 選單群組 */
        .nx-menu-group { margin-bottom: 20px; }
        .nx-menu-title { 
            font-size: 0.75em; 
            color: var(--nx-text-muted); 
            margin-bottom: 10px; 
            padding-left: 10px; 
            font-weight: bold; 
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .nx-menu-item {
            padding: 8px 12px; 
            cursor: pointer; 
            border-radius: var(--nx-radius); 
            color: var(--nx-text);
            display: flex; align-items: center; gap: 10px; 
            font-size: 0.95em; 
            opacity: 0.8; 
            transition: all 0.2s;
            text-decoration: none; 
        }
        .nx-menu-item:hover, .nx-menu-item.active { 
            background: var(--nx-hover-bg);
            opacity: 1; 
            color: var(--nx-accent); 
        }
        .nx-icon { width: 18px; height: 18px; stroke: currentColor; fill: none; stroke-width: 2; }

        /* 側邊欄底部 */
        .nx-sidebar-footer { 
            margin-top: auto; 
            border-top: 1px solid var(--nx-border); 
            padding-top: 15px; 
        }
        .nx-tool-row { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 15px; 
        }

        /* 底部按鈕樣式 (語言/風格) */
        .nx-footer-btn {
            background: transparent; 
            border: 1px solid var(--nx-border); 
            color: var(--nx-text-muted);
            width: 32px; height: 32px; 
            border-radius: 50%; 
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; 
            transition: all 0.3s;
            position: relative; /* 為了定位選單 */
        }
        .nx-footer-btn:hover, .nx-footer-btn.active { color: var(--nx-accent); border-color: var(--nx-accent); }

        /* 通用彈出選單 (Dropdown) */
        .nx-dropdown-menu {
            position: absolute;
            bottom: 100%;
            left: 0;
            background: var(--nx-sidebar);
            border: 1px solid var(--nx-border);
            border-radius: var(--nx-radius);
            padding: 5px;
            display: none;
            flex-direction: column;
            min-width: 140px;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
            z-index: 100;
            margin-bottom: 10px;
        }
        .nx-dropdown-menu.show { display: flex; animation: fadeIn 0.2s; }
        
        .nx-dropdown-item {
            padding: 8px 12px;
            cursor: pointer;
            font-size: 0.85em;
            color: var(--nx-text);
            border-radius: 4px;
            transition: background 0.2s;
            display: flex; align-items: center; gap: 8px;
        }
        .nx-dropdown-item:hover { background: var(--nx-hover-bg); color: var(--nx-accent); }
        .nx-dropdown-item.active { color: var(--nx-accent); font-weight: bold; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* 使用者頭像 */
        .nx-user-profile {
            display: flex; align-items: center; gap: 10px; cursor: pointer;
            padding: 8px; border-radius: var(--nx-radius);
        }
        .nx-user-profile:hover { background: var(--nx-hover-bg); }
        .nx-avatar { width: 28px; height: 28px; border-radius: 50%; object-fit: cover; background: #333; }
        .nx-username { font-size: 0.9em; font-weight: bold; }

        /* --- 主內容區 --- */
        .nx-main {
            flex: 1; 
            position: relative; 
            display: flex; 
            flex-direction: column;
            background: var(--nx-bg);
        }

        /* 聊天顯示區 */
        .nx-chat-area { 
            flex: 1; 
            overflow-y: auto; 
            padding: 40px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
        }
        
        /* 歡迎畫面 */
        .nx-welcome { text-align: center; margin-top: 10vh; max-width: 700px; width: 100%; }
        .nx-welcome h1 { 
            font-size: 2.5rem; 
            margin-bottom: 30px; 
            font-weight: 300; 
            line-height: 1.2;
        }
        .nx-welcome span { 
            color: var(--nx-accent); 
            font-weight: 700; 
            /* 終端機風格不使用漸層文字 */
            [data-theme="business"] &, [data-theme="tech"] & {
                background: linear-gradient(90deg, var(--nx-text), var(--nx-accent));
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
            }
        }

        /* 建議卡片網格 */
        .nx-suggestion-grid {
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 15px; 
            width: 100%; 
            margin-top: 40px;
        }
        .nx-suggestion-card {
            background: var(--nx-card-bg); 
            border: 1px solid var(--nx-border); 
            padding: 15px 20px;
            border-radius: var(--nx-radius); 
            cursor: pointer; 
            text-align: left; 
            font-size: 0.95em;
            transition: all 0.2s;
            display: flex; justify-content: space-between; align-items: center;
        }
        .nx-suggestion-card:hover { 
            border-color: var(--nx-accent); 
            transform: translateY(-2px); 
            box-shadow: var(--nx-glow);
        }
        .nx-sug-arrow { opacity: 0.5; font-size: 0.8em; }

        /* --- 新版輸入框樣式 (參考圖片) --- */
        .nx-input-container {
            width: 100%; 
            max-width: 800px; 
            margin: 0 auto 40px auto; 
            position: relative; 
            padding: 0 20px;
        }
        
        .nx-input-wrapper {
            background: var(--nx-input-bg); 
            border: 1px solid var(--nx-border); 
            border-radius: 16px; /* 稍微方一點的圓角 */
            padding: 12px 16px; 
            display: flex; 
            flex-direction: column; /* 上下排列 */
            gap: 8px;
            box-shadow: var(--nx-glow);
            transition: border-color 0.3s;
        }
        
        /* 終端機輸入框樣式調整 */
        [data-theme="terminal"] .nx-input-wrapper { border-radius: 0; border: 2px solid var(--nx-border); box-shadow: none; }
        .nx-input-wrapper:focus-within { border-color: var(--nx-accent); }
        
        /* 上層：輸入區 */
        .nx-textarea {
            width: 100%; 
            background: transparent; 
            border: none; 
            color: var(--nx-text);
            font-size: 1rem; 
            resize: none; 
            max-height: 200px; 
            min-height: 24px;
            outline: none; 
            font-family: inherit; 
            line-height: 1.5;
            padding: 0;
        }

        /* 下層：工具列 */
        .nx-input-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 4px;
        }

        .nx-input-left, .nx-input-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* 底部工具按鈕通用樣式 */
        .nx-tool-btn {
            background: transparent;
            border: none;
            color: var(--nx-text-muted);
            cursor: pointer;
            padding: 6px;
            border-radius: 6px;
            transition: all 0.2s;
            display: flex; align-items: center; gap: 6px;
            font-size: 0.85em;
            font-weight: 500;
        }
        .nx-tool-btn:hover {
            color: var(--nx-accent);
            background: var(--nx-hover-bg);
        }
        
        /* 膠囊狀按鈕 (左側功能) */
        .nx-pill-btn {
            border: 1px solid transparent;
            background: rgba(255,255,255,0.03);
            border-radius: 20px;
            padding: 4px 10px;
        }
        .nx-pill-btn:hover, .nx-pill-btn.active {
            border-color: var(--nx-accent);
            color: var(--nx-accent);
            background: var(--nx-btn-active-bg);
        }

        /* 發送按鈕 */
        .nx-send-btn {
            background: var(--nx-accent); 
            color: #000; 
            border: none; 
            width: 32px; height: 32px;
            border-radius: 8px; /* 方圓形 */
            display: flex; align-items: center; justify-content: center; 
            cursor: pointer;
            transition: transform 0.2s, opacity 0.2s;
        }
        .nx-send-btn:hover { transform: scale(1.05); opacity: 0.9; }
        [data-theme="terminal"] .nx-send-btn { border-radius: 0; background: var(--nx-text); }

        /* 回首頁按鈕 (Dropdown 樣式) */
        .back-to-home-container {
            position: absolute; top: 20px; right: 20px; z-index: 50;
        }
        .back-to-home-btn {
            color: var(--nx-text-muted); 
            text-decoration: none;
            font-size: 0.8em; 
            border: 1px solid var(--nx-border);
            padding: 6px 14px; 
            border-radius: var(--nx-radius);
            transition: all 0.2s;
            background: var(--nx-card-bg);
            cursor: pointer;
            display: flex; align-items: center; gap: 5px;
        }
        .back-to-home-btn:hover { border-color: var(--nx-accent); color: var(--nx-accent); }
        
        .home-dropdown {
            position: absolute; top: 110%; right: 0;
            background: var(--nx-sidebar);
            border: 1px solid var(--nx-border);
            border-radius: var(--nx-radius);
            width: 160px;
            display: none;
            flex-direction: column;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            padding: 5px;
        }
        .home-dropdown.show { display: flex; }

        /* RWD */
        @media (max-width: 768px) {
            .nx-sidebar { display: none; } /* 手機版暫時隱藏側欄 */
            .nx-welcome h1 { font-size: 1.8rem; }
            .nx-suggestion-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body data-theme="tech"> <!-- 預設主題 -->

    <!-- 左側導航欄 -->
    <div class="nx-sidebar">
        <!-- Logo NodeX -->
        <div class="nx-brand" onclick="window.location.reload()">
            <!-- 節點形狀的 X Logo -->
            <svg class="nx-logo-svg" viewBox="0 0 24 24">
                <path d="M4 4l16 16" stroke-linecap="round"/>
                <path d="M20 4l-16 16" stroke-linecap="round"/>
                <circle cx="4" cy="4" r="2.5" fill="currentColor" stroke="none"/>
                <circle cx="20" cy="20" r="2.5" fill="currentColor" stroke="none"/>
                <circle cx="20" cy="4" r="2.5" fill="currentColor" stroke="none"/>
                <circle cx="4" cy="20" r="2.5" fill="currentColor" stroke="none"/>
                <circle cx="12" cy="12" r="1.5" fill="var(--nx-accent)" stroke="none"/>
            </svg>
            <span>NodeX</span>
        </div>
        
        <!-- 新對話按鈕 -->
        <button class="nx-btn-new" onclick="alert('Starting New Chat Session...')">
            <svg class="nx-icon" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
            <span id="txt-newChat">新對話</span>
        </button>

        <!-- 選單 1: 搜尋 -->
        <div class="nx-menu-group">
            <div class="nx-menu-item" style="color:var(--nx-text-muted); padding-left:12px;">
                <svg class="nx-icon" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                <span id="txt-search" style="font-size:0.9em;">搜尋對話...</span>
            </div>
        </div>

        <!-- 選單 2: 分類 (非 Agent) -->
        <div class="nx-menu-group">
            <div class="nx-menu-title">EXPLORE</div>
            <div class="nx-menu-item active">
                <svg class="nx-icon" viewBox="0 0 24 24"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
                <span id="txt-finance">金融</span>
            </div>
            <div class="nx-menu-item">
                <svg class="nx-icon" viewBox="0 0 24 24"><polygon points="12 2 2 7 12 12 22 7 12 2"></polygon><polyline points="2 17 12 22 22 17"></polyline><polyline points="2 12 12 17 22 12"></polyline></svg>
                <span id="txt-tech">科技</span>
            </div>
            <div class="nx-menu-item">
                <svg class="nx-icon" viewBox="0 0 24 24"><path d="M12 19l7-7 3 3-7 7-3-3z"></path><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path><path d="M2 2l7.586 7.586"></path><circle cx="11" cy="11" r="2"></circle></svg>
                <span id="txt-studio">主題工作室</span>
            </div>
        </div>

        <!-- 選單 3: 歷史紀錄 -->
        <div class="nx-menu-group" style="flex:1;">
            <div class="nx-menu-title" id="txt-history">歷史紀錄</div>
            <div class="nx-menu-item" style="font-size:0.85em;">• AAPL vs MSFT Analysis</div>
            <div class="nx-menu-item" style="font-size:0.85em;">• Crypto Market Cap</div>
        </div>

        <!-- 真正的 Create Agent -->
        <div class="nx-menu-group">
            <div class="nx-menu-item" style="color:var(--nx-accent); border:1px dashed var(--nx-border);">
                <svg class="nx-icon" viewBox="0 0 24 24"><rect x="4" y="4" width="16" height="16" rx="2" ry="2"></rect><rect x="9" y="9" width="6" height="6"></rect><line x1="9" y1="1" x2="9" y2="4"></line><line x1="15" y1="1" x2="15" y2="4"></line><line x1="9" y1="20" x2="9" y2="23"></line><line x1="15" y1="20" x2="15" y2="23"></line><line x1="20" y1="9" x2="23" y2="9"></line><line x1="20" y1="14" x2="23" y2="14"></line><line x1="1" y1="9" x2="4" y2="9"></line><line x1="1" y1="14" x2="4" y2="14"></line></svg>
                <span id="txt-createAgent">創建 AI Agent</span>
            </div>
        </div>

        <!-- 底部工具列 -->
        <div class="nx-sidebar-footer">
            <div class="nx-tool-row">
                <!-- 地球語言切換 -->
                <div style="position:relative;">
                    <button class="nx-footer-btn" onclick="toggleMenu('lang-menu')" title="Switch Language">
                        <svg class="nx-icon" style="width:20px;height:20px;" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>
                    </button>
                    <!-- 語言選單 -->
                    <div class="nx-dropdown-menu" id="lang-menu" style="bottom: 110%; left: 0;">
                        <div class="nx-dropdown-item active" onclick="setLanguage('zh-TW')">繁體中文</div>
                        <div class="nx-dropdown-item" onclick="setLanguage('en')">English</div>
                    </div>
                </div>

                <!-- 風格切換 -->
                <div style="position:relative;">
                    <button class="nx-footer-btn" onclick="toggleMenu('theme-menu')" title="Switch Theme">
                        <svg class="nx-icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
                    </button>
                    <!-- 風格選單 -->
                    <div class="nx-dropdown-menu" id="theme-menu" style="bottom: 110%; left: -50px;">
                        <div class="nx-dropdown-item" onclick="setTheme('business')">Business 商務</div>
                        <div class="nx-dropdown-item active" onclick="setTheme('tech')">Tech 科幻</div>
                        <div class="nx-dropdown-item" onclick="setTheme('terminal')">Terminal 終端</div>
                    </div>
                </div>
            </div>
            
            <!-- 使用者資訊 (需要 Firebase) -->
            <div class="nx-user-profile" id="user-profile-section">
                <img src="" class="nx-avatar" id="nx-user-avatar" style="display:none;">
                <div class="nx-username" id="nx-user-name">GUEST</div>
            </div>
        </div>
    </div>

    <!-- 右側主區域 -->
    <div class="nx-main">
        
        <!-- 回首頁按鈕 (Dropdown) -->
        <div class="back-to-home-container">
            <button class="back-to-home-btn" onclick="toggleMenu('home-menu')">
                切換 ▼
            </button>
            <div class="nx-dropdown-menu home-dropdown" id="home-menu" style="top: 110%; right: 0; left: auto; bottom: auto;">
                <div class="nx-dropdown-item" onclick="window.location.href='app.html#workspace'">Workspace</div>
                <div class="nx-dropdown-item" onclick="window.location.href='PulesStreet.html#pulse'">PulseStreet</div>
            </div>
        </div>

        <div class="nx-chat-area">
            <div class="nx-welcome">
                <h1 id="txt-welcome">早安，<br><span>開始您製作一份分析報告？</span></h1>
                <div class="nx-suggestion-grid">
                    <div class="nx-suggestion-card"><span id="txt-sug1">分析 NVDA 財報重點</span> <span class="nx-sug-arrow">↗</span></div>
                    <div class="nx-suggestion-card"><span id="txt-sug2">比特幣下週走勢預測</span> <span class="nx-sug-arrow">↗</span></div>
                    <div class="nx-suggestion-card"><span id="txt-sug3">制定台股當沖策略</span> <span class="nx-sug-arrow">↗</span></div>
                    <div class="nx-suggestion-card"><span id="txt-sug4">總體經濟數據解讀</span> <span class="nx-sug-arrow">↗</span></div>
                </div>
            </div>
        </div>

        <!-- 全新設計的輸入框區塊 -->
        <div class="nx-input-container">
            <div class="nx-input-wrapper">
                <!-- 第一層：輸入區 -->
                <textarea class="nx-textarea" id="nx-input" rows="1" placeholder="詢問任何問題。輸入 @ 以提及。"></textarea>
                
                <!-- 第二層：工具列 -->
                <div class="nx-input-footer">
                    <!-- 左側功能：搜尋 + 模型 -->
                    <div class="nx-input-left">
                        <button class="nx-tool-btn nx-pill-btn" title="網頁搜尋 (Web Search)">
                            <svg class="nx-icon" style="width:16px;height:16px;" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>
                            <span style="font-size:0.8em; font-weight:600;">搜尋</span>
                        </button>
                        <button class="nx-tool-btn nx-pill-btn" title="切換模型 (Switch Model)">
                            <svg class="nx-icon" style="width:16px;height:16px;" viewBox="0 0 24 24"><rect x="4" y="4" width="16" height="16" rx="2" ry="2"></rect><rect x="9" y="9" width="6" height="6"></rect><line x1="9" y1="1" x2="9" y2="4"></line><line x1="15" y1="1" x2="15" y2="4"></line><line x1="9" y1="20" x2="9" y2="23"></line><line x1="15" y1="20" x2="15" y2="23"></line><line x1="20" y1="9" x2="23" y2="9"></line><line x1="20" y1="14" x2="23" y2="14"></line><line x1="1" y1="9" x2="4" y2="9"></line><line x1="1" y1="14" x2="4" y2="14"></line></svg>
                            <span style="font-size:0.8em; font-weight:600;">深度思考 (R1)</span>
                        </button>
                    </div>

                    <!-- 右側功能：附件 + 語音 + 發送 -->
                    <div class="nx-input-right">
                        <button class="nx-tool-btn" title="Attach File">
                            <svg class="nx-icon" viewBox="0 0 24 24"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg>
                        </button>
                        <button class="nx-tool-btn" title="Voice Input">
                            <svg class="nx-icon" viewBox="0 0 24 24"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>
                        </button>
                        <button class="nx-send-btn" title="Send Message">
                            <svg class="nx-icon" style="width:18px;height:18px;stroke:white;" viewBox="0 0 24 24"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                        </button>
                    </div>
                </div>
            </div>
            <div style="text-align:center; font-size:0.7em; color:var(--nx-text-muted); margin-top:10px;">
                NodeX AI can make mistakes. Please verify important financial information.
            </div>
        </div>
    </div>

    <!-- Firebase SDK (用於同步登入狀態) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAIwisA_UnOiNRVwYE6tJV47Sp3_1i19IM",
            authDomain: "brooklyn-terminal.firebaseapp.com",
            projectId: "brooklyn-terminal",
            storageBucket: "brooklyn-terminal.firebasestorage.app",
            messagingSenderId: "438411734316",
            appId: "1:438411734316:web:649051890cf381eb0fd089",
            measurementId: "G-G0GMW0XHG1"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        onAuthStateChanged(auth, (user) => {
            const nameEl = document.getElementById('nx-user-name');
            const avatarEl = document.getElementById('nx-user-avatar');
            if (user) {
                nameEl.innerText = user.displayName;
                if(user.photoURL) {
                    avatarEl.src = user.photoURL;
                    avatarEl.style.display = 'block';
                }
            } else {
                nameEl.innerText = "GUEST (Login)";
                avatarEl.style.display = 'none';
            }
        });
    </script>

    <script>
        // --- 互動邏輯 ---
        let currentLang = 'zh-TW';
        
        // 語言字典
        const i18n = {
            'zh-TW': {
                newChat: "新對話",
                search: "搜尋對話...",
                finance: "金融",
                tech: "科技",
                studio: "主題工作室",
                history: "歷史紀錄",
                createAgent: "創建 AI Agent",
                welcome: "早安，<br><span>需要分析什麼市場？</span>",
                placeholder: "詢問任何問題。輸入 @ 以提及。",
                sug1: "分析 NVDA 財報重點",
                sug2: "比特幣下週走勢預測",
                sug3: "制定台股當沖策略",
                sug4: "總體經濟數據解讀"
            },
            'en': {
                newChat: "New Chat",
                search: "Search chats...",
                finance: "Finance",
                tech: "Technology",
                studio: "Theme Studio",
                history: "History",
                createAgent: "Create AI Agent",
                welcome: "Good Morning.<br><span>Market Analysis?</span>",
                placeholder: "Ask anything. Type @ to mention.",
                sug1: "Analyze NVDA Earnings",
                sug2: "BTC Price Prediction",
                sug3: "Day Trading Strategy",
                sug4: "Macro Data Insights"
            }
        };

        // DOM 元素
        const body = document.body;
        const inputArea = document.getElementById('nx-input');

        // 通用選單開關
        window.toggleMenu = (id) => {
            // 關閉其他已開啟的選單
            document.querySelectorAll('.nx-dropdown-menu').forEach(m => {
                if(m.id !== id) m.classList.remove('show');
            });
            document.getElementById(id).classList.toggle('show');
        }

        // 點擊外部關閉選單
        window.addEventListener('click', (e) => {
            if (!e.target.closest('.nx-footer-btn') && !e.target.closest('.back-to-home-btn')) {
                document.querySelectorAll('.nx-dropdown-menu').forEach(m => m.classList.remove('show'));
            }
        });

        // 主題設定
        window.setTheme = (theme) => {
            body.setAttribute('data-theme', theme);
            // 更新選單激活狀態
            document.querySelectorAll('#theme-menu .nx-dropdown-item').forEach(el => {
                el.classList.toggle('active', el.innerText.toLowerCase().includes(theme));
            });
        }

        // 語言設定
        window.setLanguage = (lang) => {
            currentLang = lang;
            updateLanguage();
            // 更新選單激活狀態
            document.querySelectorAll('#lang-menu .nx-dropdown-item').forEach(el => {
                const isZh = lang === 'zh-TW' && el.innerText.includes('中文');
                const isEn = lang === 'en' && el.innerText.includes('English');
                el.classList.toggle('active', isZh || isEn);
            });
        }

        function updateLanguage() {
            const t = i18n[currentLang];
            document.getElementById('txt-newChat').innerText = t.newChat;
            document.getElementById('txt-search').innerText = t.search;
            document.getElementById('txt-finance').innerText = t.finance;
            document.getElementById('txt-tech').innerText = t.tech;
            document.getElementById('txt-studio').innerText = t.studio;
            document.getElementById('txt-history').innerText = t.history;
            document.getElementById('txt-createAgent').innerText = t.createAgent;
            document.getElementById('nx-input').placeholder = t.placeholder;
            document.getElementById('txt-welcome').innerHTML = t.welcome;
            
            document.getElementById('txt-sug1').innerText = t.sug1 + " ↗";
            document.getElementById('txt-sug2').innerText = t.sug2 + " ↗";
            document.getElementById('txt-sug3').innerText = t.sug3 + " ↗";
            document.getElementById('txt-sug4').innerText = t.sug4 + " ↗";
        }

        // 輸入框自動高度
        inputArea.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
            if(this.value === '') this.style.height = 'auto';
        });
    </script>
</body>
</html>
